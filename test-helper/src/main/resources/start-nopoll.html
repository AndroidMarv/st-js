<html>
<head>
<script>
	var browserId = -1;
	var lastTestSrc = null;
	var logDiv, statusDiv;
	var iframe;
	var queryStringParameters;

	function status(s, msg){
		state = s;
		statusDiv.innerHTML = "#" + count + " " + state + ":" + (msg || "") ;
	}

	function log(s){
		logDiv.innerHTML += "<span class='time'>" + new Date().toLocaleTimeString() + "</span> " + s + "<br>";
	}
	
	function reportResultAndRunNextTest(result, stacktrace){
		if (result != "OK" && console) {
			console.error(result + '\n' + stacktrace);
		}
		iframe.src = '/getNextTest' + 
				'?browserId=' + browserId + 
				'&result=' + result + 
				'&location=' + stacktrace + 
				'&rand=' + Math.random();
	}
	
	function runFirstTest(){
		reportResultAndRunNextTest("OK");
	}
	
	// Shamelessly lifted from 
	// http://stackoverflow.com/questions/901115/how-can-i-get-query-string-values
	function decodeParameters(){
		var match,
	        pl     = /\+/g,  // Regex for replacing addition symbol with a space
	        search = /([^&=]+)=?([^&]*)/g,
	        decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
	        query  = window.location.search.substring(1);
		
		var params = {};
	    while (match = search.exec(query)){
	       params[decode(match[1])] = decode(match[2]);
	    }
	    return params;
	}
	
	onload = function() {
		iframe = document.getElementById("iframe");
		logDiv = document.getElementById("log");
		statusDiv = document.getElementById("status");
		queryStringParameters = decodeParameters();
		browserId = queryStringParameters['browserId'];
		runFirstTest();
	}
</script>
<style>
	#status {
		border-bottom: solid 1px #ccc;
		padding-bottom: 5px;
	}
	#iframe {
		float:left;
	}
	#log {
		float:left;
		width:400px;
		padding-left: 20px;
		font-size: .8em;
		height: 90%;
		overflow-y: auto;
	}
	.time {
		color:lightgray;
	}
</style>
</head>
<body>
	<div id="status"></div>
	<iframe id="iframe" src="about:blank" width=600 height=400></iframe>
	<div id="log"></div>
</body>
</html>